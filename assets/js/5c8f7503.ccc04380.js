"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1910],{4379:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>o});var c=i(4848),t=i(8453);const s={sidebar_position:5},l="Deploy \u1ee9ng d\u1ee5ng NodeJS v\u1edbi pm2",r={id:"javascript/deploy-pm2",title:"Deploy \u1ee9ng d\u1ee5ng NodeJS v\u1edbi pm2",description:"Pm2 l\xe0 g\xec?",source:"@site/docs/javascript/deploy-pm2.md",sourceDirName:"javascript",slug:"/javascript/deploy-pm2",permalink:"/engineering-wiki/docs/javascript/deploy-pm2",draft:!1,unlisted:!1,editUrl:"https://github.com/AvengersCodeLovers/engineering-wiki/tree/main/docs/javascript/deploy-pm2.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"docsSidebar",previous:{title:"Docker c\u01a1 b\u1ea3n cho d\u1ef1 \xe1n Node.js",permalink:"/engineering-wiki/docs/javascript/docker-nodejs"},next:{title:"PHP",permalink:"/engineering-wiki/docs/category/php"}},d={},o=[{value:"Pm2 l\xe0 g\xec?",id:"pm2-l\xe0-g\xec",level:2},{value:"T\u1ea1i sao n\xean s\u1eed d\u1ee5ng pm2?",id:"t\u1ea1i-sao-n\xean-s\u1eed-d\u1ee5ng-pm2",level:2},{value:"C\xe0i \u0111\u1eb7t v\xe0 config",id:"c\xe0i-\u0111\u1eb7t-v\xe0-config",level:2},{value:"C\xe0i \u0111\u1eb7t pm2",id:"c\xe0i-\u0111\u1eb7t-pm2",level:3},{value:"Config pm2",id:"config-pm2",level:3},{value:"C\xe1c command c\u01a1 b\u1ea3n c\u1ee7a pm2",id:"c\xe1c-command-c\u01a1-b\u1ea3n-c\u1ee7a-pm2",level:2},{value:"Pm2 deployment",id:"pm2-deployment",level:2}];function h(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.h1,{id:"deploy-\u1ee9ng-d\u1ee5ng-nodejs-v\u1edbi-pm2",children:"Deploy \u1ee9ng d\u1ee5ng NodeJS v\u1edbi pm2"}),"\n",(0,c.jsx)(e.h2,{id:"pm2-l\xe0-g\xec",children:"Pm2 l\xe0 g\xec?"}),"\n",(0,c.jsxs)(e.p,{children:["pm2 l\xe0 m\u1ed9t c\xf4ng c\u1ee5 qu\u1ea3n l\xfd ti\u1ebfn tr\xecnh Node.js, gi\xfap b\u1ea1n kh\u1edfi \u0111\u1ed9ng, gi\xe1m s\xe1t v\xe0 qu\u1ea3n l\xfd c\xe1c \u1ee9ng d\u1ee5ng Node.js c\u1ee7a m\xecnh m\u1ed9t c\xe1ch d\u1ec5 d\xe0ng. N\xf3 \u0111\u1eb7c bi\u1ec7t h\u1eefu \xedch trong production b\u1edfi \u0111\u1ea3m b\u1ea3o zero-downtime\nDocument pm2: ",(0,c.jsx)(e.a,{href:"https://pm2.keymetrics.io/docs/usage/quick-start/",children:"https://pm2.keymetrics.io/docs/usage/quick-start/"})]}),"\n",(0,c.jsx)(e.h2,{id:"t\u1ea1i-sao-n\xean-s\u1eed-d\u1ee5ng-pm2",children:"T\u1ea1i sao n\xean s\u1eed d\u1ee5ng pm2?"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"Kh\u1edfi \u0111\u1ed9ng l\u1ea1i t\u1ef1 \u0111\u1ed9ng: Khi \u1ee9ng d\u1ee5ng g\u1eb7p l\u1ed7i v\xe0 b\u1ecb crash, pm2 s\u1ebd t\u1ef1 \u0111\u1ed9ng kh\u1edfi \u0111\u1ed9ng l\u1ea1i."}),"\n",(0,c.jsx)(e.li,{children:"Qu\u1ea3n l\xfd nhi\u1ec1u ti\u1ebfn tr\xecnh: B\u1ea1n c\xf3 th\u1ec3 qu\u1ea3n l\xfd nhi\u1ec1u \u1ee9ng d\u1ee5ng Node.js kh\xe1c nhau c\xf9ng m\u1ed9t l\xfac."}),"\n",(0,c.jsx)(e.li,{children:"Xem log: pm2 cung c\u1ea5p c\xe1c l\u1ec7nh \u0111\u1ec3 xem log c\u1ee7a c\xe1c ti\u1ebfn tr\xecnh m\u1ed9t c\xe1ch d\u1ec5 d\xe0ng."}),"\n",(0,c.jsx)(e.li,{children:"C\xe2n b\u1eb1ng t\u1ea3i: pm2 c\xf3 kh\u1ea3 n\u0103ng ph\xe2n ph\u1ed1i t\u1ea3i cho c\xe1c ti\u1ebfn tr\xecnh tr\xean nhi\u1ec1u CPU."}),"\n",(0,c.jsx)(e.li,{children:"Clustering: T\u1ea1o nhi\u1ec1u instance c\u1ee7a \u1ee9ng d\u1ee5ng \u0111\u1ec3 t\u0103ng kh\u1ea3 n\u0103ng x\u1eed l\xfd."}),"\n",(0,c.jsx)(e.li,{children:"Zero downtime deployment: Tri\u1ec3n khai \u1ee9ng d\u1ee5ng m\u1edbi m\xe0 kh\xf4ng l\xe0m gi\xe1n \u0111o\u1ea1n d\u1ecbch v\u1ee5."}),"\n"]}),"\n",(0,c.jsx)(e.h2,{id:"c\xe0i-\u0111\u1eb7t-v\xe0-config",children:"C\xe0i \u0111\u1eb7t v\xe0 config"}),"\n",(0,c.jsx)(e.h3,{id:"c\xe0i-\u0111\u1eb7t-pm2",children:"C\xe0i \u0111\u1eb7t pm2"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"npm install pm2 -g\n"})}),"\n",(0,c.jsx)(e.h3,{id:"config-pm2",children:"Config pm2"}),"\n",(0,c.jsx)(e.p,{children:"C\xf3 hai c\xe1ch ch\xednh \u0111\u1ec3 c\u1ea5u h\xecnh pm2:"}),"\n",(0,c.jsxs)(e.ol,{children:["\n",(0,c.jsx)(e.li,{children:"C\u1ea5u h\xecnh qua d\xf2ng l\u1ec7nh"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"pm2 start app.js\n"})}),"\n",(0,c.jsxs)(e.ol,{start:"2",children:["\n",(0,c.jsx)(e.li,{children:"C\u1ea5u h\xecnh qua file ecosystem.config.js"}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:"T\u1ea1o m\u1ed9t file t\xean ecosystem.config.js \u1edf th\u01b0 m\u1ee5c g\u1ed1c c\u1ee7a d\u1ef1 \xe1n v\xe0 c\u1ea5u h\xecnh c\xe1c \u1ee9ng d\u1ee5ng c\u1ee7a b\u1ea1n trong \u0111\xf3."}),"\n",(0,c.jsx)(e.p,{children:"V\xed d\u1ee5:"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-javascript",children:"module.exports = {\n  apps : [{\n    name: 'my-app',\n    script: 'app.js',\n    instances: 'max', // S\u1ed1 l\u01b0\u1ee3ng instance t\u1ed1i \u0111a\n    exec_mode: 'cluster', // Ch\u1ebf \u0111\u1ed9 cluster\n    env: {\n      NODE_ENV: 'development'\n    },\n    env_production : {\n      NODE_ENV: 'production'\n    }\n  }]\n};\n"})}),"\n",(0,c.jsx)(e.p,{children:"Sau \u0111\xf3, kh\u1edfi \u0111\u1ed9ng c\xe1c \u1ee9ng d\u1ee5ng b\u1eb1ng l\u1ec7nh:"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"pm2 start ecosystem.config.js\n"})}),"\n",(0,c.jsx)(e.h2,{id:"c\xe1c-command-c\u01a1-b\u1ea3n-c\u1ee7a-pm2",children:"C\xe1c command c\u01a1 b\u1ea3n c\u1ee7a pm2"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"pm2 start app.js: Kh\u1edfi \u0111\u1ed9ng \u1ee9ng d\u1ee5ng app.js."}),"\n",(0,c.jsx)(e.li,{children:"pm2 list: Li\u1ec7t k\xea t\u1ea5t c\u1ea3 c\xe1c ti\u1ebfn tr\xecnh \u0111ang ch\u1ea1y."}),"\n",(0,c.jsx)(e.li,{children:"pm2 stop all: D\u1eebng t\u1ea5t c\u1ea3 c\xe1c ti\u1ebfn tr\xecnh."}),"\n",(0,c.jsx)(e.li,{children:"pm2 restart all: Kh\u1edfi \u0111\u1ed9ng l\u1ea1i t\u1ea5t c\u1ea3 c\xe1c ti\u1ebfn tr\xecnh."}),"\n",(0,c.jsx)(e.li,{children:"pm2 delete all: X\xf3a t\u1ea5t c\u1ea3 c\xe1c ti\u1ebfn tr\xecnh."}),"\n",(0,c.jsx)(e.li,{children:"pm2 logs: Xem log c\u1ee7a t\u1ea5t c\u1ea3 c\xe1c ti\u1ebfn tr\xecnh."}),"\n",(0,c.jsx)(e.li,{children:"pm2 monit: Theo d\xf5i c\xe1c ti\u1ebfn tr\xecnh trong th\u1eddi gian th\u1ef1c."}),"\n",(0,c.jsx)(e.li,{children:"pm2 save: L\u01b0u c\u1ea5u h\xecnh hi\u1ec7n t\u1ea1i."}),"\n",(0,c.jsx)(e.li,{children:"pm2 resurrect: Kh\xf4i ph\u1ee5c c\u1ea5u h\xecnh \u0111\xe3 l\u01b0u."}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:"V\xed d\u1ee5 s\u1eed d\u1ee5ng"}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"# Kh\u1edfi \u0111\u1ed9ng \u1ee9ng d\u1ee5ng app.js v\u1edbi 2 instance\npm2 start app.js -i 2\n\n# Xem log c\u1ee7a \u1ee9ng d\u1ee5ng app.js\npm2 logs app.js\n\n# Restart t\u1ea5t c\u1ea3 c\xe1c ti\u1ebfn tr\xecnh\npm2 restart all\n"})}),"\n",(0,c.jsx)(e.h2,{id:"pm2-deployment",children:"Pm2 deployment"}),"\n",(0,c.jsxs)(e.p,{children:["Module n\xe0y gi\xfap b\u1ea1n c\xf3 th\u1ec3 deploy \u1ee9ng d\u1ee5ng l\xean c\xe1c m\xf4i tr\u01b0\u1eddng kh\xe1c nhau ch\u1ec9 t\u1eeb command line\nDocument: ",(0,c.jsx)(e.a,{href:"https://pm2.keymetrics.io/docs/usage/deployment/",children:"https://pm2.keymetrics.io/docs/usage/deployment/"})]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["B\u01b0\u1edbc 1: C\u1ea5u h\xecnh ph\u1ea7n ",(0,c.jsx)(e.code,{children:"deploy"})," trong file config"]}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-javascript",children:'module.exports = {\n  apps : [{\n    script: \'api.js\',\n  }, {\n    script: \'worker.js\'\n  }],\n   \n  // Deployment Configuration\n  deploy : {\n    production : {\n       "user" : "ubuntu",\n       "host" : ["192.168.0.13", "192.168.0.14", "192.168.0.15"],\n       "ref"  : "origin/master",\n       "repo" : "git@github.com:Username/repository.git",\n       "path" : "/var/www/my-repository",\n       "post-deploy" : "npm install"\n    }\n  }\n};\n'})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"B\u01b0\u1edbc 2: Setup l\u1ea7n \u0111\u1ea7u cho server"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"pm2 deploy production setup\n"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"B\u01b0\u1edbc 3: Th\u1ef1c hi\u1ec7n deploy"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-bash",children:"pm2 deploy production\n"})}),"\n",(0,c.jsxs)(e.p,{children:["T\xf3m l\u1ea1i, ",(0,c.jsx)(e.strong,{children:"pm2"})," l\xe0 m\u1ed9t c\xf4ng c\u1ee5 h\u1eefu \xedch cho c\xe1c nh\xe0 ph\xe1t tri\u1ec3n Node.js, gi\xfap b\u1ea1n qu\u1ea3n l\xfd v\xe0 gi\xe1m s\xe1t \u1ee9ng d\u1ee5ng c\u1ee7a m\xecnh m\u1ed9t c\xe1ch hi\u1ec7u qu\u1ea3. V\u1edbi nh\u1eefng l\u1ee3i \xedch v\xe0 t\xednh n\u0103ng \u0111a d\u1ea1ng, pm2 s\u1ebd gi\xfap b\u1ea1n ti\u1ebft ki\u1ec7m th\u1eddi gian v\xe0 c\xf4ng s\u1ee9c trong qu\xe1 tr\xecnh ph\xe1t tri\u1ec3n v\xe0 tri\u1ec3n khai \u1ee9ng d\u1ee5ng."]})]})}function p(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(h,{...n})}):h(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>r});var c=i(6540);const t={},s=c.createContext(t);function l(n){const e=c.useContext(s);return c.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),c.createElement(s.Provider,{value:e},n.children)}}}]);