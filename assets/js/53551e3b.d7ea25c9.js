"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9996],{4878:(n,c,e)=>{e.r(c),e.d(c,{assets:()=>s,contentTitle:()=>r,default:()=>a,frontMatter:()=>h,metadata:()=>o,toc:()=>l});var t=e(4848),i=e(8453);const h={sidebar_position:2,title:"Dockerfile"},r="Dockerfile",o={id:"docker/docker-file",title:"Dockerfile",description:"M\u1ed9t t\u1ec7p Dockerfile s\u1ebd ch\u1ee9a c\xe1c n\u1ed9i dung \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a n\xean m\u1ed9t Docker Image v\xe0 l\xe0 \u0111\u1ea7u v\xe0o ch\xednh c\u1ee7a Docker Engine khi c\xe2u l\u1ec7nh docker build ... \u0111\u01b0\u1ee3c th\u1ef1c thi.",source:"@site/docs/docker/docker-file.md",sourceDirName:"docker",slug:"/docker/docker-file",permalink:"/engineering-wiki/docs/docker/docker-file",draft:!1,unlisted:!1,editUrl:"https://github.com/AvengersCodeLovers/engineering-wiki/tree/main/docs/docker/docker-file.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Dockerfile"},sidebar:"docsSidebar",previous:{title:"T\u1ed5ng quan",permalink:"/engineering-wiki/docs/docker/why_docker"},next:{title:"Docker Compose",permalink:"/engineering-wiki/docs/docker/docker-compose"}},s={},l=[{value:"Kh\xf4ng \u0111\u01b0\u1ee3c ph\xe9p n\xe2ng c\u1ea5p phi\xean b\u1ea3n c\u1ee7a h\u1ec7 \u0111i\u1ec1u h\xe0nh b\u1eb1ng c\xe2u l\u1ec7nh.",id:"kh\xf4ng-\u0111\u01b0\u1ee3c-ph\xe9p-n\xe2ng-c\u1ea5p-phi\xean-b\u1ea3n-c\u1ee7a-h\u1ec7-\u0111i\u1ec1u-h\xe0nh-b\u1eb1ng-c\xe2u-l\u1ec7nh",level:2},{value:"B\xean trong Dockerfile, \u0111\u1eebng s\u1eed d\u1ee5ng c\xe1c ph\u1ea7n m\u1ec1m nh\u01b0 puppet, ansible, salt, ...",id:"b\xean-trong-dockerfile-\u0111\u1eebng-s\u1eed-d\u1ee5ng-c\xe1c-ph\u1ea7n-m\u1ec1m-nh\u01b0-puppet-ansible-salt-",level:2},{value:"Ch\u1ec9 s\u1eed d\u1ee5ng nh\u1eefng image \u0111\u01b0\u1ee3c ph\xe1t tri\u1ec3n t\u1eeb nh\u1eefng ngu\u1ed3n tin c\u1eady",id:"ch\u1ec9-s\u1eed-d\u1ee5ng-nh\u1eefng-image-\u0111\u01b0\u1ee3c-ph\xe1t-tri\u1ec3n-t\u1eeb-nh\u1eefng-ngu\u1ed3n-tin-c\u1eady",level:2},{value:"Kh\xf4ng \u0111\u01b0\u1ee3c ph\xe9p ch\u1ee9a th\xf4ng tin b\xed m\u1eadt trong Dockerfile (ho\u1eb7c repository t\u01b0\u01a1ng \u1ee9ng)",id:"kh\xf4ng-\u0111\u01b0\u1ee3c-ph\xe9p-ch\u1ee9a-th\xf4ng-tin-b\xed-m\u1eadt-trong-dockerfile-ho\u1eb7c-repository-t\u01b0\u01a1ng-\u1ee9ng",level:2},{value:"Verify c\xe1c artifacts \u0111\xe3 download",id:"verify-c\xe1c-artifacts-\u0111\xe3-download",level:2},{value:"Verify c\xe1c artifacts \u0111\xe3 download (I)",id:"verify-c\xe1c-artifacts-\u0111\xe3-download-i",level:3},{value:"Verify c\xe1c artifacts \u0111\xe3 download (II)",id:"verify-c\xe1c-artifacts-\u0111\xe3-download-ii",level:3},{value:"H\u1ea1n ch\u1ebf c\xe1c ti\u1ebfn tr\xecnh v\u1edbi quy\u1ec1n &quot;root&quot; trong container",id:"h\u1ea1n-ch\u1ebf-c\xe1c-ti\u1ebfn-tr\xecnh-v\u1edbi-quy\u1ec1n-root-trong-container",level:2},{value:"Ch\u1ec9 EXPOSE nh\u1eefng c\u1ed5ng c\u1ea7n thi\u1ebft",id:"ch\u1ec9-expose-nh\u1eefng-c\u1ed5ng-c\u1ea7n-thi\u1ebft",level:2},{value:"Ghi Log/Error ra Stdout/Stderr",id:"ghi-logerror-ra-stdoutstderr",level:2},{value:"S\u1eed d\u1ee5ng Exec thay v\xec Shell",id:"s\u1eed-d\u1ee5ng-exec-thay-v\xec-shell",level:2},{value:"M\u1ed9t ti\u1ebfn tr\xecnh/d\u1ecbch v\u1ee5 tr\xean m\u1ed7i container",id:"m\u1ed9t-ti\u1ebfn-tr\xecnhd\u1ecbch-v\u1ee5-tr\xean-m\u1ed7i-container",level:2},{value:"M\u1ed9t Dockerfile cho m\u1ed7i Source Repository",id:"m\u1ed9t-dockerfile-cho-m\u1ed7i-source-repository",level:2},{value:"S\u1eed d\u1ee5ng ch\u1ebf \u0111\u1ed9 <code>interactive</code> \u0111\u1ec3 ki\u1ec3m tra c\xe1c c\xe2u l\u1ec7nh",id:"s\u1eed-d\u1ee5ng-ch\u1ebf-\u0111\u1ed9-interactive-\u0111\u1ec3-ki\u1ec3m-tra-c\xe1c-c\xe2u-l\u1ec7nh",level:2},{value:"Gi\u1ea3m s\u1ed1 l\u01b0\u1ee3ng layer",id:"gi\u1ea3m-s\u1ed1-l\u01b0\u1ee3ng-layer",level:2},{value:"\u01afu ti\xean c\xe0i \u0111\u1eb7t c\xe1c ph\u1ea7n m\u1ec1m tr\u01b0\u1edbc",id:"\u01b0u-ti\xean-c\xe0i-\u0111\u1eb7t-c\xe1c-ph\u1ea7n-m\u1ec1m-tr\u01b0\u1edbc",level:2},{value:"\u0110\u1eebng s\u1eed d\u1ee5ng ADD v\u1edbi URL",id:"\u0111\u1eebng-s\u1eed-d\u1ee5ng-add-v\u1edbi-url",level:2},{value:"Th\xeam (nhi\u1ec1u) t\u1ec7p tin th\xf4ng qua th\u01b0 m\u1ee5c c\xf3 c\u1ea5u tr\xfac",id:"th\xeam-nhi\u1ec1u-t\u1ec7p-tin-th\xf4ng-qua-th\u01b0-m\u1ee5c-c\xf3-c\u1ea5u-tr\xfac",level:2},{value:"Thi\u1ebft l\u1eadp quy\u1ec1n truy c\u1eadp cho t\u1ec7p tin b\xean ngo\xe0i Dockerfile \u0111\xfang c\xe1ch",id:"thi\u1ebft-l\u1eadp-quy\u1ec1n-truy-c\u1eadp-cho-t\u1ec7p-tin-b\xean-ngo\xe0i-dockerfile-\u0111\xfang-c\xe1ch",level:2},{value:"Entrypoint vs CMD",id:"entrypoint-vs-cmd",level:2}];function d(n){const c={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.h1,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,t.jsxs)(c.p,{children:["M\u1ed9t t\u1ec7p Dockerfile s\u1ebd ch\u1ee9a c\xe1c n\u1ed9i dung \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a n\xean m\u1ed9t Docker Image v\xe0 l\xe0 \u0111\u1ea7u v\xe0o ch\xednh c\u1ee7a Docker Engine khi c\xe2u l\u1ec7nh ",(0,t.jsx)(c.code,{children:"docker build ..."})," \u0111\u01b0\u1ee3c th\u1ef1c thi."]}),"\n",(0,t.jsx)(c.h2,{id:"kh\xf4ng-\u0111\u01b0\u1ee3c-ph\xe9p-n\xe2ng-c\u1ea5p-phi\xean-b\u1ea3n-c\u1ee7a-h\u1ec7-\u0111i\u1ec1u-h\xe0nh-b\u1eb1ng-c\xe2u-l\u1ec7nh",children:"Kh\xf4ng \u0111\u01b0\u1ee3c ph\xe9p n\xe2ng c\u1ea5p phi\xean b\u1ea3n c\u1ee7a h\u1ec7 \u0111i\u1ec1u h\xe0nh b\u1eb1ng c\xe2u l\u1ec7nh."}),"\n",(0,t.jsxs)(c.p,{children:[(0,t.jsx)(c.strong,{children:"C\xd3 TH\u1ec2"}),' "c\u1eadp nh\u1eadt" c\xe1c g\xf3i ph\u1ea7n m\u1ec1m c\u1ee7a h\u1ec7 \u0111i\u1ec1u h\xe0nh b\xean trong ',(0,t.jsx)(c.strong,{children:"Base Image"}),", nh\u01b0ng ",(0,t.jsx)(c.strong,{children:"Kh\xf4ng \u0110\u01b0\u1ee3c Ph\xe9p"})," thay th\u1ebf ",(0,t.jsx)(c.strong,{children:"Base Image"}),' b\u1eb1ng vi\u1ec7c "n\xe2ng c\u1ea5p"" b\xean trong Dockerfile.']}),"\n",(0,t.jsx)(c.p,{children:"Nh\u01b0 n\xe0y th\xec kh\xf4ng sao"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"FROM ubuntu: 14.04.1\nRUN apt-get update \\\n    && apt-get install -y ...\n# ...\n"})}),"\n",(0,t.jsx)(c.p,{children:"Nh\u01b0ng nh\u01b0 n\xe0y th\xec kh\xf4ng \u0111\u01b0\u1ee3c"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"FROM ubuntu: 14.04.1\nRUN apt-get update \\\n    && apt-get upgrade -y\n    && apt-get install -y ...\n# ...\n"})}),"\n",(0,t.jsxs)(c.p,{children:["C\xe2u l\u1ec7nh ",(0,t.jsx)(c.code,{children:"apt-get upgrade"})," (ho\u1eb7c nh\u1eefng c\xe2u l\u1ec7nh n\xe2ng c\u1ea5p ",(0,t.jsx)(c.strong,{children:"Base Image"})," kh\xe1c t\u01b0\u01a1ng \u0111\u01b0\u01a1ng) c\xf3 th\u1ec3 l\xe0m thay \u0111\u1ed5i phi\xean b\u1ea3n c\u1ee7a nh\u1eefng ph\u1ea7n m\u1ec1m \u0111\xe3 c\xe0i \u0111\u1eb7t s\u1eb5n ho\u1eb7c th\u1eadm ch\xed c\xe0i \u0111\u1eb7t ho\u1eb7c xo\xe1 b\u1ecf nh\u1eefng g\xf3i ph\u1ea7n m\u1ec1m tr\xean dependency m\u1edbi. K\u1ebft qu\u1ea3 l\xe0 Docker Image kh\xf4ng c\xf2n gi\u1ed1ng v\u1edbi ",(0,t.jsx)(c.strong,{children:"Base Image"})," n\u1eefa."]}),"\n",(0,t.jsxs)(c.p,{children:["N\u1ebfu c\u1ea7n ph\u1ea3i thay \u0111\u1ed5i \u0111i\u1ec1u g\xec khi ch\u1ea1y ",(0,t.jsx)(c.code,{children:"docker build"})," b\u1ecb l\u1ed7i, h\xe3y ",(0,t.jsx)(c.strong,{children:"C\xc2N NH\u1eaeC"})," thay \u0111\u1ed5i lu\xf4n phi\xean b\u1ea3n ",(0,t.jsx)(c.strong,{children:"Base Image"})]}),"\n",(0,t.jsx)(c.p,{children:"FROM ubuntu: new-version"}),"\n",(0,t.jsx)(c.h1,{id:"",children:"..."}),"\n",(0,t.jsx)(c.h2,{id:"b\xean-trong-dockerfile-\u0111\u1eebng-s\u1eed-d\u1ee5ng-c\xe1c-ph\u1ea7n-m\u1ec1m-nh\u01b0-puppet-ansible-salt-",children:"B\xean trong Dockerfile, \u0111\u1eebng s\u1eed d\u1ee5ng c\xe1c ph\u1ea7n m\u1ec1m nh\u01b0 puppet, ansible, salt, ..."}),"\n",(0,t.jsxs)(c.p,{children:["Theo nh\u01b0 t\xe0i li\u1ec7u m\xf4 t\u1ea3 v\u1ec1 Dockerfile ",(0,t.jsx)(c.a,{href:"https://docs.docker.com/engine/reference/builder/",children:"Dockerfile reference"})," c\xf3 \u0111\u1ecbnh ngh\u0129a nh\u01b0 sau:"]}),"\n",(0,t.jsxs)(c.blockquote,{children:["\n",(0,t.jsxs)(c.p,{children:["[...] is a text document that contains ",(0,t.jsx)(c.strong,{children:"all"})," the commands a user could ",(0,t.jsx)(c.strong,{children:"call on the command line"})," to assemble an image."]}),"\n"]}),"\n",(0,t.jsxs)(c.blockquote,{children:["\n",(0,t.jsxs)(c.p,{children:["[...] l\xe0 m\u1ed9t t\u1ec7p tin v\u0103n b\u1ea3n ch\u1ee9a ",(0,t.jsx)(c.strong,{children:"t\u1ea5t c\u1ea3"})," nh\u1eefng c\xe2u l\u1ec7nh m\xe0 ng\u01b0\u1eddi d\xf9ng c\xf3 th\u1ec3 ",(0,t.jsx)(c.strong,{children:"g\u1ecdi tr\xean command line"})," \u0111\u1ec3 l\u1eafp r\xe1p th\xe0nh m\u1ed9t image."]}),"\n"]}),"\n",(0,t.jsx)(c.p,{children:"N\u1ebfu s\u1eed d\u1ee5ng c\xe1c c\xf4ng c\u1ee5 qu\u1ea3n l\xfd c\u1ea5u h\xecnh b\xean (configuration management tool) trong container, d\xf9 v\u1eabn \u0111\u01b0\u1ee3c ph\xe9p nh\u01b0ng c\xf3 nh\u1eefng r\u1ee7i ro sau:"}),"\n",(0,t.jsxs)(c.ol,{children:["\n",(0,t.jsxs)(c.li,{children:["V\xf4 h\xecnh chung c\xe0i \u0111\u1eb7t nh\u1eefng ph\u1ea7n m\u1ec1m v\xe0 d\u1ecbch v\u1ee5 kh\xf4ng c\u1ea7n thi\u1ebft ho\u1eb7c c\xf3 r\u1ee7i ro khi ch\u1ea1y (v\xed d\u1ee5 m\u1ed9t c\u01a1 s\u1edf d\u1eef li\u1ec7u th\xec kh\xf4ng c\u1ea7n ph\u1ea3i c\xf3 ",(0,t.jsx)(c.a,{href:"https://www.puppet.com/",children:"puppet"}),")."]}),"\n",(0,t.jsx)(c.li,{children:"C\xf3 nh\u1eefng b\u01b0\u1edbc c\xe0i \u0111\u1eb7t ng\u1ea7m \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n b\u1edfi b\u1ea5t c\u1ee9 ai s\u1edf h\u1eefu Dockerfile, l\xe0m m\u1ea5t \u0111i t\xednh minh b\u1ea1ch c\u1ee7a Dockerfile."}),"\n",(0,t.jsx)(c.li,{children:"H\u1ea7u h\u1ebft m\u1ecdi ng\u01b0\u1eddi s\u1ebd quen v\u1edbi c\xe1c ph\u1ea7n m\u1ec1m qu\u1ea3n l\xfd package nh\u01b0 apt, apk, yum,..., thay v\xec c\xe1c c\xf4ng c\u1ee5 qu\u1ea3n l\xfd c\u1ea5u h\xecnh."}),"\n"]}),"\n",(0,t.jsx)(c.h2,{id:"ch\u1ec9-s\u1eed-d\u1ee5ng-nh\u1eefng-image-\u0111\u01b0\u1ee3c-ph\xe1t-tri\u1ec3n-t\u1eeb-nh\u1eefng-ngu\u1ed3n-tin-c\u1eady",children:"Ch\u1ec9 s\u1eed d\u1ee5ng nh\u1eefng image \u0111\u01b0\u1ee3c ph\xe1t tri\u1ec3n t\u1eeb nh\u1eefng ngu\u1ed3n tin c\u1eady"}),"\n",(0,t.jsx)(c.p,{children:"Vi\u1ec7c download (pull) v\xe0 s\u1eed d\u1ee5ng c\xe1c image \u0111\u01b0\u1ee3c d\u1ef1ng s\u1eb5n t\u1eeb nh\u1eefng ngu\u1ed3n c\u1ed9ng \u0111\u1ed3ng kh\xe1 l\xe0 ti\u1ec7n l\u1ee3i v\xe0 d\u1ec5 d\xe0ng."}),"\n",(0,t.jsxs)(c.p,{children:["Tuy nhi\xean, \u0111\u1ec3 tr\xe1nh r\u1ee7i ro t\u1eeb nh\u1eefng image thi\u1ebfu chu\u1ea9n ch\u1ec9nh ho\u1eb7c b\u1ecb ng\u1eebng ph\xe1t tri\u1ec3n, ch\xfang ta ch\u1ec9 n\xean s\u1eed d\u1ee5ng nh\u1eefng Docker Image ",(0,t.jsx)(c.strong,{children:"ch\xednh th\u1ee9c"})," t\u1eeb ",(0,t.jsx)(c.strong,{children:"Docker Hub"})," t\u1ea1i ",(0,t.jsx)(c.a,{href:"https://hub.docker.com/",children:"https://hub.docker.com/"})," cho c\xe1c m\xf4i tr\u01b0\u1eddng ch\xednh (kh\xf4ng ph\u1ea3i m\xf4i tr\u01b0\u1eddng th\u1eed nghi\u1ec7m )."]}),"\n",(0,t.jsxs)(c.p,{children:["V\xed d\u1ee5 v\u1ec1 m\u1ed9t Dockerfile s\u1eed d\u1ee5ng ",(0,t.jsx)(c.strong,{children:"Docker Hub"})]}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:'# official image, because there is NO account or the "library" account being used\nFROM ubuntu:14.04.1\n# FROM library/ubuntu:14.04.1\n# FROM hub.docker.com/library/ubuntu:14.04.1\n'})}),"\n",(0,t.jsx)(c.h2,{id:"kh\xf4ng-\u0111\u01b0\u1ee3c-ph\xe9p-ch\u1ee9a-th\xf4ng-tin-b\xed-m\u1eadt-trong-dockerfile-ho\u1eb7c-repository-t\u01b0\u01a1ng-\u1ee9ng",children:"Kh\xf4ng \u0111\u01b0\u1ee3c ph\xe9p ch\u1ee9a th\xf4ng tin b\xed m\u1eadt trong Dockerfile (ho\u1eb7c repository t\u01b0\u01a1ng \u1ee9ng)"}),"\n",(0,t.jsx)(c.p,{children:"M\u1ed9t v\xed d\u1ee5 x\u1ea5u c\u1ee7a Dockerfile"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"FROM ubuntu:14.04.1\nMAINTAINER ...\nENV API_KEY=4711101 \\\n    USR=admin \\\n    PWD=the_admin_password \\\n    CREDITCARD=5555 3333 2222\nADD the_same_secrets.txt /etc\n# ...\n"})}),"\n",(0,t.jsxs)(c.p,{children:["B\u1eaft bu\u1ed9c ph\u1ea3i gi\u1eef c\xe1c th\xf4ng tin b\xed m\u1eadt (secret keys) ra kh\u1ecfi Dockerfile ",(0,t.jsx)(c.strong,{children:"V\xc0"})," repository t\u01b0\u01a1ng \u1ee9ng."]}),"\n",(0,t.jsx)(c.p,{children:"Docker repository c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c chia s\u1ebb c\xf4ng khai, v\xe0 th\xf4ng tin b\xed m\u1eadt c\xf3 th\u1ec3 b\u1ecb l\u1ed9 ra ngo\xe0i.\nNgay c\u1ea3 nh\u1eefng private repository, vi\u1ec7c s\u1eed d\u1ee5ng c\xe1c th\xf4ng tin b\xed m\u1eadt trong Dockerfile c\u0169ng l\xe0 m\u1ed9t r\u1ee7i ro."}),"\n",(0,t.jsx)(c.p,{children:"C\xf3 th\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1 b\u1eb1ng nh\u1eefng c\xe1ch sau:"}),"\n",(0,t.jsxs)(c.ul,{children:["\n",(0,t.jsxs)(c.li,{children:["cung c\u1ea5p th\xf4ng tin b\xed m\u1eadt d\u01b0\u1edbi d\u1ea1ng ",(0,t.jsx)(c.strong,{children:"bi\u1ebfn m\xf4i tr\u01b0\u1eddng"})," khi kh\u1edfi \u0111\u1ed9ng container v\u1edbi ",(0,t.jsx)(c.code,{children:"docker run -e API_KEY=4711 ..."})]}),"\n",(0,t.jsxs)(c.li,{children:["t\u1ea1o ",(0,t.jsx)(c.strong,{children:"repository ri\xeang bi\u1ec7t cho c\xe1c container ch\u1ee9a th\xf4ng tin b\xed m\u1eadt"})," m\xe0 kh\xf4ng bao gi\u1edd b\u1ecb c\xf4ng khai ra ngo\xe0i"]}),"\n",(0,t.jsxs)(c.li,{children:["t\u1ea1o c\xe1c container ch\u1ec9 ch\u1ee9a ",(0,t.jsx)(c.strong,{children:'c\u1ea5u h\xecnh "t\u1ea1m th\u1eddi"'})," trong qu\xe1 tr\xecnh c\xe0i \u0111\u1eb7t"]}),"\n",(0,t.jsxs)(c.li,{children:["\u0111\u1ec3 ",(0,t.jsx)(c.strong,{children:"entrypoint ho\u1eb7c command c\u1ee7a container l\u1ea5y th\xf4ng tin b\xed m\u1eadt"})," khi kh\u1edfi \u0111\u1ed9ng."]}),"\n"]}),"\n",(0,t.jsx)(c.h2,{id:"verify-c\xe1c-artifacts-\u0111\xe3-download",children:"Verify c\xe1c artifacts \u0111\xe3 download"}),"\n",(0,t.jsxs)(c.p,{children:["Khi s\u1eed d\u1ee5ng Dockerfile v\u1edbi c\xe2u l\u1ec7nh ",(0,t.jsx)(c.code,{children:"docker build"}),", c\xe1c t\u1ec7p t\u1eeb h\u1ec7 th\u1ed1ng t\u1ec7p c\u1ee5c b\u1ed9 (build context) c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng ho\u1eb7c \u0111\u01b0\u1ee3c l\u1ea5y t\u1eeb c\xe1c d\u1ecbch v\u1ee5 trong m\u1ea1ng n\u1ed9i b\u1ed9 ho\u1eb7c internet."]}),"\n",(0,t.jsx)(c.p,{children:"B\u1eaft bu\u1ed9c ph\u1ea3i verify c\xe1c t\u1ec7p \u0111\u01b0\u1ee3c download t\u1eeb b\xean ngo\xe0i."}),"\n",(0,t.jsx)(c.h3,{id:"verify-c\xe1c-artifacts-\u0111\xe3-download-i",children:"Verify c\xe1c artifacts \u0111\xe3 download (I)"}),"\n",(0,t.jsx)(c.p,{children:"C\xf3 th\u1ec3 verify b\u1eb1ng m\u1ed9t trong nh\u1eefng c\xe1ch sau:"}),"\n",(0,t.jsxs)(c.ul,{children:["\n",(0,t.jsx)(c.li,{children:"S\u1eed d\u1ee5ng ch\u1eef k\xfd \u1edf m\u1ed9t t\u1ec7p ri\xeang bi\u1ec7t"}),"\n",(0,t.jsx)(c.li,{children:"S\u1eed d\u1ee5ng m\u1ed9t file \u0111\xe3 \u0111\u01b0\u1ee3c hash v\xe0 k\u1ebft h\u1ee3p v\u1edbi m\u1ed9t file ch\u1eef k\xfd t\u1eeb public keyserver."}),"\n"]}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:'     # ...\n    ENV HASHICORP_KEYIDS=51852D87348FFC4C\n     # ...\n    RUN curl -sL https://releases.hashicorp.com/vault/0.5.0/vault_0.5.0_linux_amd64.zip >  vault_0.5.0_linux_amd64.zip \\\n        && curl -sL https://releases.hashicorp.com/vault/0.5.0/vault_0.5.0_SHA256SUMS > app.sha \\\n        && curl -sL https://releases.hashicorp.com/vault/0.5.0/vault_0.5.0_SHA256SUMS.sig > app.sig \\\n        && gpg --recv-keys ${HASHICORP_KEYIDS} \\\n        && gpg --verify app.sig app.sha \\\n        && grep linux_amd64 app.sha | sha256sum -sc \\\n        && echo "We only get here if sha256sum succeeded ..."\n'})}),"\n",(0,t.jsxs)(c.blockquote,{children:["\n",(0,t.jsx)(c.p,{children:"S\u1eed d\u1ee5ng keyserver v\u1edbi giao th\u1ee9c HTTP (c\u1ed5ng 80) c\xf3 th\u1ec3 gi\xfap gi\u1ea3i quy\u1ebft c\xe1c v\u1ea5n \u0111\u1ec1 v\u1edbi t\u01b0\u1eddng l\u1eeda (firewall), thay v\xec HTTPS."}),"\n"]}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:'     # ...\n    ENV HASHICORP_KEYIDS=51852D87348FFC4C\n     # ...\n\tRUN curl -sL https://releases.hashicorp.com/vault/0.5.0/vault_0.5.0_linux_amd64.zip >  vault_0.5.0_linux_amd64.zip \\\n        && curl -sL https://releases.hashicorp.com/vault/0.5.0/vault_0.5.0_SHA256SUMS > app.sha \\\n        && curl -sL https://releases.hashicorp.com/vault/0.5.0/vault_0.5.0_SHA256SUMS.sig > app.sig \\\n        && gpg --keyserver http://pool.sks-keyservers.net:80 --recv-keys ${HASHICORP_KEYIDS} \\\n        && gpg --verify app.sig app.sha \\\n        && grep linux_amd64 app.sha | sha256sum -sc \\\n        && echo "We only get here if sha256sum succeeded ..."\n'})}),"\n",(0,t.jsx)(c.h3,{id:"verify-c\xe1c-artifacts-\u0111\xe3-download-ii",children:"Verify c\xe1c artifacts \u0111\xe3 download (II)"}),"\n",(0,t.jsxs)(c.p,{children:["N\u1ebfu kh\xf4ng c\xf3 l\u1ef1a ch\u1ecdn n\xe0o t\u1ed1t h\u01a1n, b\u1ea1n ",(0,t.jsx)(c.strong,{children:"N\xcaN"})," s\u1eed d\u1ee5ng HASH t\u1eeb m\u1ed9t ngu\u1ed3n tin c\u1eady (v\xed d\u1ee5 nh\u01b0 \u0111\u1eb7t tr\u1ef1c ti\u1ebfp trong Dockerfile)"]}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:'     # ...\n\tENV VAULT_SHA256=f81accce15313881b8d53b039daf090398b2204b1154f821a863438ca2e5d570\n     # ...\n    RUN curl -sL https://releases.hashicorp.com/vault/0.5.0/vault_0.5.0_linux_amd64.zip > /tmp/my_file \\\n        && echo "${VAULT_SHA256}  /tmp/my_file" | sha256sum -sc  \\\n        && echo "We only get here if sha256sum succeeded ..."\n'})}),"\n",(0,t.jsx)(c.h2,{id:"h\u1ea1n-ch\u1ebf-c\xe1c-ti\u1ebfn-tr\xecnh-v\u1edbi-quy\u1ec1n-root-trong-container",children:'H\u1ea1n ch\u1ebf c\xe1c ti\u1ebfn tr\xecnh v\u1edbi quy\u1ec1n "root" trong container'}),"\n",(0,t.jsx)(c.p,{children:'M\u1ed9t ti\u1ebfn tr\xecnh b\xean trong container kh\xf4ng n\xean ch\u1ea1y v\u1edbi quy\u1ec1n root (v\u1edbi uid "0") \u0111\u1ec3 gi\u1ea3m thi\u1ec3u r\u1ee7i ro khi ch\u1ea1y - \u0111\u1eb7c bi\u1ec7t l\xe0 v\u1edbi c\xe1c volume (root-owned ?) t\u1eeb host. Ngay c\u1ea3 Docker Engine > 1.10 (v\u1edbi c\xe1c t\xednh n\u0103ng b\u1ea3o m\u1eadt m\u1edbi \u0111\u01b0\u1ee3c k\xedch ho\u1ea1t) c\u0169ng l\xe0 m\u1ed9t r\u1ee7i ro c\u1ea7n tr\xe1nh.'}),"\n",(0,t.jsx)(c.p,{children:"N\u1ebfu c\xf3 th\u1ec3, h\xe3y s\u1eed d\u1ee5ng m\u1ed9t user ri\xeang bi\u1ec7t \u0111\u1ec3 ch\u1ea1y c\xe1c ti\u1ebfn tr\xecnh b\xean trong Dockerfile."}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:'host$ cat dockerfile\nFROM ubuntu\n\n# Installing as almighty "root"\nRUN ...\nCOPY ...\n\n# now switching to harmless "guest" runtime user\nUSER guest\n\nENTRYPOINT ["/my_entrypoint.sh"]\nCMD ["/my_command.sh"]\n'})}),"\n",(0,t.jsxs)(c.blockquote,{children:["\n",(0,t.jsx)(c.p,{children:"M\u1ed9t s\u1ed1 ti\u1ebfn tr\xecnh - nh\u01b0 Apache ho\u1eb7c Nginx - ph\u1ea3i \u0111\u01b0\u1ee3c kh\u1edfi \u0111\u1ed9ng v\u1edbi quy\u1ec1n root,\nnh\u01b0ng thi\u1ebft l\u1eadp \u0111\u1ec3 chuy\u1ec3n sang m\u1ed9t user runtime kh\xe1c s\u1ebd \xedt r\u1ee7i ro h\u01a1n."}),"\n"]}),"\n",(0,t.jsx)(c.h2,{id:"ch\u1ec9-expose-nh\u1eefng-c\u1ed5ng-c\u1ea7n-thi\u1ebft",children:"Ch\u1ec9 EXPOSE nh\u1eefng c\u1ed5ng c\u1ea7n thi\u1ebft"}),"\n",(0,t.jsxs)(c.p,{children:["Trong Dockerfile, ch\u1ec9 n\xean ",(0,t.jsx)(c.code,{children:"EXPOSE"})," nh\u1eefng c\u1ed5ng c\u1ea7n thi\u1ebft ra b\xean ngo\xe0i container. N\u1ebfu m\u1ed9t ti\u1ebfn tr\xecnh cung c\u1ea5p API qua c\u1ed5ng 80 V\xc0 443, nh\u01b0ng l\u1ea1i kh\xf4ng c\u1ea7n t\u1edbi c\u1ed5ng 80, th\xec \u0111i\u1ec1u n\xe0y n\xean \u0111\u01b0\u1ee3c ph\u1ea3n \xe1nh trong Dockerfile:"]}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:" #\nADD ...\n\n # Disabled\n # EXPOSE 80\n\n #\nEXPOSE 443\n"})}),"\n",(0,t.jsx)(c.h2,{id:"ghi-logerror-ra-stdoutstderr",children:"Ghi Log/Error ra Stdout/Stderr"}),"\n",(0,t.jsx)(c.p,{children:"Docker Daemon (tr\xecnh qu\u1ea3n l\xfd Docker) l\u01b0u ho\u1eb7c chuy\u1ec3n ti\u1ebfp d\u1eef li\u1ec7u (chu\u1ed7i v\u0103n b\u1ea3n) \u0111\u01b0\u1ee3c ghi ra stdout ho\u1eb7c stderr b\u1edfi ti\u1ebfn tr\xecnh b\xean trong container. Container n\xean s\u1eed d\u1ee5ng ch\u1ee9c n\u0103ng n\xe0y, n\u1ebfu c\xf3 th\u1ec3, \u0111\u1ec3 h\u1ed7 tr\u1ee3 m\u1ed9t ph\u01b0\u01a1ng th\u1ee9c qu\u1ea3n l\xfd log chu\u1ea9n ch\u1ec9nh."}),"\n",(0,t.jsx)(c.p,{children:"Stdout n\xean ch\u1ee9a nh\u1eefng th\xf4ng tin th\xf4ng th\u01b0\u1eddng v\u1ec1 ho\u1ea1t \u0111\u1ed9ng c\u1ee7a c\xe1c ti\u1ebfn tr\xecnh, trong khi stderr n\xean \u0111\u01b0\u1ee3c gi\u1edbi h\u1ea1n v\u1edbi nh\u1eefng th\xf4ng b\xe1o v\u1ec1 l\u1ed7i k\u1ef9 thu\u1eadt ho\u1eb7c c\u1ea3nh b\xe1o m\xe0 ng\u01b0\u1eddi v\u1eadn h\xe0nh ho\u1eb7c qu\u1ea3n tr\u1ecb vi\xean ph\u1ea3i ch\xfa \xfd."}),"\n",(0,t.jsx)(c.p,{children:"Nh\u1eefng n\u1ed9i dung trong log n\xean \u0111\u01b0\u1ee3c chu\u1ea9n ho\xe1 (v\xed d\u1ee5 nh\u01b0 \u0111\u1ecbnh d\u1ea1ng json) \u0111\u1ec3 tr\xe1nh vi\u1ec7c ph\u1ea3i ph\xe2n t\xedch nhi\u1ec1u b\u01b0\u1edbc trong qu\xe1 tr\xecnh x\u1eed l\xfd sau n\xe0y."}),"\n",(0,t.jsx)(c.p,{children:"\u0110\u01b0\u01a1ng nhi\xean, \u1ee9ng d\u1ee5ng c\xf3 th\u1ec3 s\u1eed d\u1ee5ng c\xe1c ph\u01b0\u01a1ng ti\u1ec7n kh\xe1c (b\u1ed5 sung) \u0111\u1ec3 chuy\u1ec3n ti\u1ebfp log nh\u01b0ng vi\u1ec7c ghi log ra stdout/stderr l\xe0 m\u1ed9t c\xe1ch ti\u1ebfp c\u1eadn t\u1ee9c th\u1eddi nh\u1ea5t."}),"\n",(0,t.jsx)(c.h2,{id:"s\u1eed-d\u1ee5ng-exec-thay-v\xec-shell",children:"S\u1eed d\u1ee5ng Exec thay v\xec Shell"}),"\n",(0,t.jsxs)(c.p,{children:["N\xean vi\u1ebft c\xe1c c\xe2u l\u1ec7nh ",(0,t.jsx)(c.a,{href:"https://docs.docker.com/engine/reference/builder/#cmd",children:"CMD"})," v\xe0 ",(0,t.jsx)(c.a,{href:"https://docs.docker.com/engine/reference/builder/#entrypoint",children:"ENTRYPOINT"})," b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng Exec-form."]}),"\n",(0,t.jsxs)(c.p,{children:["S\u1eed d\u1ee5ng shell form s\u1ebd k\xedch ho\u1ea1t t\u1edbi ",(0,t.jsx)(c.code,{children:"/bin/sh -c"})," v\u1edbi c\xe2u l\u1ec7nh v\xe0 tham s\u1ed1 \u0111\xe3 ch\u1ec9 \u0111\u1ecbnh."]}),"\n",(0,t.jsxs)(c.p,{children:["H\u1ec7 qu\u1ea3, khi s\u1eed d\u1ee5ng l\u1ec7nh ",(0,t.jsx)(c.code,{children:"docker stop"})," ho\u1eb7c ",(0,t.jsx)(c.code,{children:"docker kill"}),", t\xedn hi\u1ec7u POSIX ch\u1ec9 \u0111\u01b0\u1ee3c g\u1eedi t\u1edbi ti\u1ebfn tr\xecnh b\xean trong container ch\u1ea1y v\u1edbi PID 1, v\xe0 n\u1ebfu ti\u1ebfn tr\xecnh \u0111\xf3 l\xe0 ",(0,t.jsx)(c.code,{children:"/bin/sh"})," th\xec thay v\xec ti\u1ebfn tr\xecnh g\u1ed1c \u0111\xe3 kh\u1edfi t\u1ea1o v\xe0 ",(0,t.jsx)(c.code,{children:"/bin/sh"})," kh\xf4ng chuy\u1ec3n ti\u1ebfp t\xedn hi\u1ec7u t\u1edbi b\u1ea5t k\u1ef3 ti\u1ebfn tr\xecnh con n\xe0o, ch\xfang ta s\u1ebd kh\xf4ng th\u1ec3 ",(0,t.jsx)(c.a,{href:"https://web.archive.org/web/20220905230623/https://www.ctl.io/developers/blog/post/gracefully-stopping-docker-containers/",children:"d\u1eebng ti\u1ebfn tr\xecnh \u0111\xfang c\xe1ch"}),"."]}),"\n",(0,t.jsx)(c.h2,{id:"m\u1ed9t-ti\u1ebfn-tr\xecnhd\u1ecbch-v\u1ee5-tr\xean-m\u1ed7i-container",children:"M\u1ed9t ti\u1ebfn tr\xecnh/d\u1ecbch v\u1ee5 tr\xean m\u1ed7i container"}),"\n",(0,t.jsx)(c.p,{children:"M\u1ed9t Dockerfile ch\u1ec9 n\xean c\xe0i \u0111\u1eb7t c\xe1c ph\u1ea7n m\u1ec1m cho m\u1ed9t service duy nh\u1ea5t."}),"\n",(0,t.jsx)(c.p,{children:"M\u1ed9t service c\xf3 th\u1ec3 l\xe0 m\u1ed9t ti\u1ebfn tr\xecnh nh\u01b0 web server ho\u1eb7c database server."}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:'FROM ubuntu:14.04.1\nCMD [ "/opt/myservice/myprogram" ]\n'})}),"\n",(0,t.jsx)(c.p,{children:'L\xfd do cho vi\u1ec7c n\xe0y l\xe0 STREAMS (Stdin/Stdout/Stderr) v\xe0 SIGNAL gi\u1eefa Docker Engine v\xe0\nc\xe1c ti\u1ebfn tr\xecnh ch\u1ea1y trong Docker Container. Khi kh\xf4ng \u0111\u01b0\u1ee3c x\xe2y d\u1ef1ng/x\u1eed l\xfd\nc\u1ea9n th\u1eadn, m\u1ed9t s\u1ed1 v\u1ea5n \u0111\u1ec1 t\u01b0\u01a1ng t\u1ef1 nh\u01b0 "unix process zombies" c\xf3 th\u1ec3 n\u1ea3y sinh ...'}),"\n",(0,t.jsx)(c.p,{children:'Vi\u1ec7c ch\u1ea1y nhi\u1ec1u service c\xf9ng l\xfac \u0111\xf2i h\u1ecfi vi\u1ec7c c\xe0i \u0111\u1eb7t v\xe0 kh\u1edfi \u0111\u1ed9ng \u1ee9ng d\u1ee5ng ph\u1ea3i theo "\u0111\xfang c\xe1ch"'}),"\n",(0,t.jsxs)(c.blockquote,{children:["\n",(0,t.jsxs)(c.p,{children:['C\xf3 nh\u1eefng gi\u1ea3i ph\xe1p \u0111\u1ec3 x\u1eed l\xfd "\u0111\xfang c\xe1ch" nhi\u1ec1u ti\u1ebfn tr\xecnh trong m\u1ed9t container nh\u01b0 ',(0,t.jsx)(c.a,{href:"https://docs.docker.com/engine/admin/using_supervisord/",children:"Vi\u1ec7c s\u1eed d\u1ee5ng Supervisor b\xean trong Docker"})]}),"\n"]}),"\n",(0,t.jsx)(c.h2,{id:"m\u1ed9t-dockerfile-cho-m\u1ed7i-source-repository",children:"M\u1ed9t Dockerfile cho m\u1ed7i Source Repository"}),"\n",(0,t.jsx)(c.p,{children:"Khi c\xf3 nhi\u1ec1u Dockerfile trong m\u1ed9t repository, vi\u1ec7c theo d\xf5i c\xe1c thay \u0111\u1ed5i v\xe0 x\xe2y d\u1ef1ng Dockerimage s\u1ebd tr\u1edf n\xean ph\u1ee9c t\u1ea1p."}),"\n",(0,t.jsxs)(c.p,{children:["\u0110\u1ed1i v\u1edbi c\xe1c tool CI/CD, autobuilds (gocd, jenkins, ...), vi\u1ec7c theo d\xf5i c\xe1c thay \u0111\u1ed5i c\u1ee7a m\u1ed9t repository cho ",(0,t.jsx)(c.strong,{children:"m\u1ed9t"})," Dockerimage v\xe0 c\xe1c ph\u1ea7n m\u1ec1m li\xean quan l\xe0 r\u1ea5t quan tr\u1ecdng."]}),"\n",(0,t.jsxs)(c.h2,{id:"s\u1eed-d\u1ee5ng-ch\u1ebf-\u0111\u1ed9-interactive-\u0111\u1ec3-ki\u1ec3m-tra-c\xe1c-c\xe2u-l\u1ec7nh",children:["S\u1eed d\u1ee5ng ch\u1ebf \u0111\u1ed9 ",(0,t.jsx)(c.code,{children:"interactive"})," \u0111\u1ec3 ki\u1ec3m tra c\xe1c c\xe2u l\u1ec7nh"]}),"\n",(0,t.jsx)(c.p,{children:"V\xed d\u1ee5, c\xf3 th\u1ec3 vi\u1ebft Dockerfile nh\u01b0 sau"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"$ cat Dockerfile\nFROM ubuntu:14.04\nRUN curl -sL https://github.com/hlgr360/docker-templates/archive/master.zip \\\n  -o /tmp/master.zip\n"})}),"\n",(0,t.jsx)(c.p,{children:"v\xe0 sau \u0111\xf3 ki\u1ec3m tra n\xf3 ..."}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"$ docker build .\nSending build context to Docker daemon 2.048 kB\nStep 1 : FROM ubuntu:14.04\n ---\x3e 14b59d36bae0\nStep 2 : RUN curl -sL https://github.com/hlgr360/docker-templates/archive/master.zip   -o /tmp/master.zip\n ---\x3e Running in 5c9deb4eb14a\n/bin/sh: 1: curl: not found\nThe command '/bin/sh -c curl -sL https://github.com/hlgr360/docker-templates/archive/master.zip   -o /tmp/master.zip' returned a non-zero code: 127\n"})}),"\n",(0,t.jsx)(c.p,{children:"ch\u1ec9nh s\u1eeda Dockerfile, ki\u1ec3m tra l\u1ea1i ..."}),"\n",(0,t.jsx)(c.p,{children:"L\u1eb7p l\u1ea1i c\xe1c b\u01b0\u1edbc tr\xean s\u1ebd t\u1ed1n th\u1eddi gian."}),"\n",(0,t.jsxs)(c.p,{children:["Vi\u1ec7c s\u1eed d\u1ee5ng ch\u1ebf \u0111\u1ed9 ",(0,t.jsx)(c.code,{children:"interactive"})," s\u1ebd gi\xfap d\u1ec5 d\xe0ng ki\u1ec3m tra c\xe1c c\xe2u l\u1ec7nh v\xe0 ki\u1ec3m tra xem ch\xfang c\xf3 ho\u1ea1t \u0111\u1ed9ng hay kh\xf4ng, tr\u01b0\u1edbc khi build, gi\u1ea3m th\u1eddi gian x\xe2y d\u1ef1ng Dockerfile."]}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"docker run -it [image] [command-or-shell]\n"})}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"$ docker run -it ubuntu:14.04 /bin/bash\nroot@10f5608e9db3:/# curl -sL  https://github.com/hlgr360/docker-templates/archive/master.zip   -o /tmp/master.zip\nbash: curl: command not found\nroot@10f5608e9db3:/# apt-get update && apt-get install -y curl\nIgn http://archive.ubuntu.com trusty InRelease\nGet:1 http://archive.ubuntu.com trusty-updates InRelease [65.9 kB]\n[...]\nSetting up curl (7.35.0-1ubuntu2.6) ...\nProcessing triggers for libc-bin (2.19-0ubuntu6.7) ...\nProcessing triggers for ca-certificates (20160104ubuntu0.14.04.1) ...\nUpdating certificates in /etc/ssl/certs... 173 added, 0 removed; done.\nRunning hooks in /etc/ca-certificates/update.d....done.\nroot@10f5608e9db3:/# curl -sL  https://github.com/hlgr360/docker-templates/archive/master.zip   -o /tmp/master.zip\nroot@10f5608e9db3:/#\n"})}),"\n",(0,t.jsx)(c.h2,{id:"gi\u1ea3m-s\u1ed1-l\u01b0\u1ee3ng-layer",children:"Gi\u1ea3m s\u1ed1 l\u01b0\u1ee3ng layer"}),"\n",(0,t.jsxs)(c.p,{children:["H\u1ea7u h\u1ebft c\xe1c c\xe2u l\u1ec7nh trong Dockerfile t\u1ea1o ra c\xe1c layer b\u1ed5 sung cho Dockerimage trong qu\xe1 tr\xecnh ch\u1ea1y ",(0,t.jsx)(c.code,{children:"docker build"}),". N\u1ebfu n\u1ed1i c\xe1c c\xe2u l\u1ec7nh \u0111\xf3, image c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c t\u1ed1i \u01b0u h\xf3a l\u1ea1i:"]}),"\n",(0,t.jsx)(c.p,{children:"Thay v\xec"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"FROM debian:wheezy\nWORKDIR /tmp\n\nENV TEST1 1\nENV TEST2 2\n\nRUN wget -nv\nRUN tar -xvf someutility-v1.0.0.tar.gz\nRUN mv /tmp/someutility-v1.0.0/someutil /usr/bin/someutil\nRUN rm -rf /tmp/someutility-v1.0.0\nRUN rm /tmp/someutility-v1.0.0.tar.gz\n"})}),"\n",(0,t.jsx)(c.p,{children:"N\xean n\u1ed1i l\u1ea1i c\xe1c c\xe2u l\u1ec7nh"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"FROM debian:wheezy\nWORKDIR /tmp\n\nENV TEST1=1 \\\n    TEST2=2\n\nRUN wget -nv && tar -xvf someutility-v1.0.0.tar.gz\n  && mv /tmp/someutility-v1.0.0/someutil /usr/bin/someutil\n  && rm -rf /tmp/someutility-v1.0.0\n  && rm /tmp/someutility-v1.0.0.tar.gz\n"})}),"\n",(0,t.jsx)(c.p,{children:"K\u1ebft qu\u1ea3 l\xe0 image c\xf3 \xedt layer h\u01a1n v\xe0 do \u0111\xf3 chi\u1ebfm \xedt kh\xf4ng gian l\u01b0u tr\u1eef h\u01a1n so v\u1edbi v\xed d\u1ee5 \u0111\u1ea7u ti\xean."}),"\n",(0,t.jsx)(c.h2,{id:"\u01b0u-ti\xean-c\xe0i-\u0111\u1eb7t-c\xe1c-ph\u1ea7n-m\u1ec1m-tr\u01b0\u1edbc",children:"\u01afu ti\xean c\xe0i \u0111\u1eb7t c\xe1c ph\u1ea7n m\u1ec1m tr\u01b0\u1edbc"}),"\n",(0,t.jsx)(c.p,{children:"C\xe1c c\xe2u l\u1ec7nh ch\u1ea1y l\xe2u d\xe0i n\xean \u0111\u01b0\u1ee3c \u0111\u1eb7t tr\u01b0\u1edbc, \u0111\u1ec3 cache build c\xf3 th\u1ec3 hi\u1ec7u qu\u1ea3."}),"\n",(0,t.jsxs)(c.p,{children:["V\xed d\u1ee5 sau l\xe0 ch\u01b0a \u1ed5n - v\xec b\u1ea5t k\u1ef3 thay \u0111\u1ed5i n\xe0o trong c\xe1c t\u1ec7p trong th\u01b0 m\u1ee5c ",(0,t.jsx)(c.code,{children:"./root"})," s\u1ebd xo\xe1 b\u1ecf cache build v\xe0 k\xedch ho\u1ea1t l\u1ea1i c\xe2u l\u1ec7nh ",(0,t.jsx)(c.code,{children:"apk --update..."}),"."]}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"# Add changed files from context\nADD root /\n\n# Update package information, install packages and clear package cache\nRUN apk --update add curl ca-certificates gnupg jq \\\n&& rm -rf /var/cache/apk/* \n"})}),"\n",(0,t.jsxs)(c.p,{children:["C\u1ea3i thi\u1ec7n h\u01a1n nh\u01b0 sau - v\xec kh\u1ea3 n\u0103ng cao, k\u1ebft qu\u1ea3 cache c\u1ee7a ",(0,t.jsx)(c.code,{children:"apk --update..."})," s\u1ebd kh\xf4ng thay \u0111\u1ed5i trong th\u1eddi gian s\u1eafp t\u1edbi. Thay \u0111\u1ed5i trong c\xe1c t\u1ec7p trong th\u01b0 m\u1ee5c ",(0,t.jsx)(c.code,{children:"./root"})," ch\u1ec9 d\u1eabn \u0111\u1ebfn m\u1ed9t layer m\u1edbi cho c\xe1c t\u1ec7p tin \u0111\xe3 thay \u0111\u1ed5i."]}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"# Update package information, install packages and clear package cache\nRUN apk --update add curl ca-certificates gnupg jq \\\n&& rm -rf /var/cache/apk/* \n\n# Add changed files from context\nADD root /\n"})}),"\n",(0,t.jsx)(c.h2,{id:"\u0111\u1eebng-s\u1eed-d\u1ee5ng-add-v\u1edbi-url",children:"\u0110\u1eebng s\u1eed d\u1ee5ng ADD v\u1edbi URL"}),"\n",(0,t.jsx)(c.p,{children:"V\xed d\u1ee5 c\xe2u l\u1ec7nh sau \u0111\xe3 v\xf4 hi\u1ec7u h\xf3a cache c\u1ee7a c\xe1c c\xe2u l\u1ec7nh Docker ti\u1ebfp theo."}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"ADD https://.../filename /tmp/filename\n# not using cache anymore :-(\n"})}),"\n",(0,t.jsx)(c.p,{children:"T\u1ed1t h\u01a1n h\xe3y s\u1eed d\u1ee5ng curl ho\u1eb7c wget (b\u1ea5t k\u1ec3 ph\u1ea7n m\u1ec1m n\xe0o c\xf3 s\u1eb5n)"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"RUN curl -L https://.../filename > /tmp/filename\n# caching still in effect :-)\n"})}),"\n",(0,t.jsx)(c.h2,{id:"th\xeam-nhi\u1ec1u-t\u1ec7p-tin-th\xf4ng-qua-th\u01b0-m\u1ee5c-c\xf3-c\u1ea5u-tr\xfac",children:"Th\xeam (nhi\u1ec1u) t\u1ec7p tin th\xf4ng qua th\u01b0 m\u1ee5c c\xf3 c\u1ea5u tr\xfac"}),"\n",(0,t.jsx)(c.p,{children:"Th\xf4ng th\u01b0\u1eddng, s\u1ebd th\xeam c\xe1c t\u1ec7p tin b\u1eb1ng c\xe2u l\u1ec7nh ADD nh\u01b0 sau"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"ADD file1.txt /some/path1/file1.txt\nADD file2.txt /some/path2/\nADD file3.txt /some/other/path3/\n"})}),"\n",(0,t.jsx)(c.p,{children:"C\xf9ng k\u1ebft qu\u1ea3 c\xf3 th\u1ec3 \u0111\u1ea1t \u0111\u01b0\u1ee3c (d\u1ec5 d\xe0ng h\u01a1n) b\u1eb1ng c\xe1ch s\u1eed d\u1ee5ng m\u1ed9t c\u1ea5u tr\xfac th\u01b0 m\u1ee5c con c\xf3 s\u1eb5n trong build-context. V\xed d\u1ee5 v\u1ec1 danh s\xe1ch t\u1ec7p"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"host$ find .\n.\n./root\n./root/etc\n./root/etc/vault\n./root/etc/vault/vault.json\n./root/entrypoint.sh\n./Dockerfile\nhost$ cat Dockerfile\nFROM ubuntu\n# Add all files from a directory structure\nADD root /\n# The image now contains /etc/vault/vault.json AND /entrypoint.sh\n"})}),"\n",(0,t.jsx)(c.h2,{id:"thi\u1ebft-l\u1eadp-quy\u1ec1n-truy-c\u1eadp-cho-t\u1ec7p-tin-b\xean-ngo\xe0i-dockerfile-\u0111\xfang-c\xe1ch",children:"Thi\u1ebft l\u1eadp quy\u1ec1n truy c\u1eadp cho t\u1ec7p tin b\xean ngo\xe0i Dockerfile \u0111\xfang c\xe1ch"}),"\n",(0,t.jsx)(c.p,{children:"L\xe0m nh\u01b0 sau l\xe0 kh\xf4ng t\u1ed1t, v\xec n\xf3 t\u1ed1n th\u1eddi gian v\xe0 t\u1ea1o ra m\u1ed9t layer m\u1edbi:"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"host$ cat Dockerfile\nFROM ubuntu\n# creates one layer\nADD entrypoint.sh /\n# creates another layer\nRUN chmod +x /entrypoint.sh\n"})}),"\n",(0,t.jsx)(c.p,{children:"Nh\u01b0 n\xe0y th\xec \u1ed5n h\u01a1n:"}),"\n",(0,t.jsx)(c.pre,{children:(0,t.jsx)(c.code,{children:"host$ chmod +x entrypoint.sh\nhost$ cat Dockerfile\nFROM ubuntu\n# creates one layer and preserves the (already set) execution flag\nADD entrypoint.sh /\n"})}),"\n",(0,t.jsx)(c.h2,{id:"entrypoint-vs-cmd",children:"Entrypoint vs CMD"}),"\n",(0,t.jsx)(c.p,{children:"N\xean s\u1eed d\u1ee5ng Entrypoint \u0111\u1ec3 ch\u1ec9 \u0111\u1ecbnh ch\u01b0\u01a1ng tr\xecnh m\u1eb7c \u0111\u1ecbnh s\u1ebd \u0111\u01b0\u1ee3c g\u1ecdi khi container \u0111\u01b0\u1ee3c kh\u1edfi \u0111\u1ed9ng v\xe0 c\xe1c \u0111\u1ed1i s\u1ed1 m\u1eb7c \u0111\u1ecbnh m\xe0 c\xf3 kh\u1ea3 n\u0103ng d\u1ec5 b\u1ecb thay \u0111\u1ed5i n\xean \u0111\u01b0\u1ee3c cung c\u1ea5p th\xf4ng qua CMD."}),"\n",(0,t.jsxs)(c.p,{children:["C\xf3 th\u1ec3 t\xecm hi\u1ec3u s\xe2u h\u01a1n ",(0,t.jsx)(c.a,{href:"https://web.archive.org/web/20220318023927/https://www.ctl.io/developers/blog/post/dockerfile-entrypoint-vs-cmd/",children:"\u1edf \u0111\xe2y"})]})]})}function a(n={}){const{wrapper:c}={...(0,i.R)(),...n.components};return c?(0,t.jsx)(c,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,c,e)=>{e.d(c,{R:()=>r,x:()=>o});var t=e(6540);const i={},h=t.createContext(i);function r(n){const c=t.useContext(h);return t.useMemo((function(){return"function"==typeof n?n(c):{...c,...n}}),[c,n])}function o(n){let c;return c=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),t.createElement(h.Provider,{value:c},n.children)}}}]);